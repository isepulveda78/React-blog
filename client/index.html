<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸš¨ HOT RELOAD TEST - Mr. S Teaches - TIME: {new Date().toLocaleTimeString()}</title>
    <style>
      body { background: linear-gradient(45deg, red, blue, green) !important; }
      .hot-reload-indicator {
        position: fixed;
        top: 10px;
        right: 10px;
        background: lime;
        color: black;
        padding: 10px;
        border-radius: 5px;
        z-index: 9999;
        font-weight: bold;
      }
    </style>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f9fa;
      }
      .min-vh-50 {
        min-height: 50vh;
      }
      .bg-gradient-to-br {
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      }
      .text-primary {
        color: #0d6efd !important;
      }
      .btn-primary {
        background-color: #0d6efd;
        border-color: #0d6efd;
      }
      .btn-primary:hover {
        background-color: #0b5ed7;
        border-color: #0a58ca;
      }
    </style>
  </head>
  <body>
    <div class="hot-reload-indicator">ðŸ”¥ HOT RELOAD ACTIVE</div>
    <div id="root"></div>
    <script>
      // Force immediate cache clear and connection check
      console.log('ðŸš€ CLEARING CACHE AND TESTING CONNECTION...')
      
      // Clear all caches immediately
      if ('caches' in window) {
        caches.keys().then(names => {
          names.forEach(name => caches.delete(name))
        })
      }
      
      // Simple polling-based hot reload (reliable fallback)
      console.log('ðŸ”¥ Starting polling hot reload...')
      let lastCheck = Date.now()
      
      function checkForUpdates() {
        fetch('/api/dev/check?t=' + Date.now(), { 
          cache: 'no-cache',
          credentials: 'same-origin'
        })
        .then(res => res.json())
        .then(data => {
          if (data.lastModified > lastCheck) {
            console.log('ðŸ”„ Files changed! Reloading...')
            window.location.reload()
          }
        })
        .catch(err => {
          console.log('Hot reload check failed:', err)
        })
      }
      
      // Check every 2 seconds
      setInterval(checkForUpdates, 2000)
      
      // Also check on focus (when user comes back to tab)
      window.addEventListener('focus', checkForUpdates)
    </script>
    <script type="module" src="/src/main.jsx"></script>
    <script type="module">
      // Simple inline hot reload system
      console.log('ðŸ”¥ Hot reload system starting...');
      
      let isReloading = false;
      
      function showNotification(message, color = '#28a745') {
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 10px;
          right: 10px;
          background: ${color};
          color: white;
          padding: 8px 12px;
          border-radius: 4px;
          font-size: 12px;
          z-index: 9999;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          font-family: Arial, sans-serif;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }
      
      function checkForChanges() {
        if (isReloading) return;
        
        const timestamp = new Date().getTime();
        
        fetch(`/src/main.jsx?t=${timestamp}`, { method: 'HEAD' })
          .then(response => {
            const modified = response.headers.get('last-modified');
            const storageKey = 'hotreload_main';
            const stored = localStorage.getItem(storageKey);
            
            if (stored && stored !== modified && !isReloading) {
              isReloading = true;
              showNotification('ðŸ”„ Changes detected, reloading...', '#007bff');
              setTimeout(() => window.location.reload(), 500);
              return;
            }
            
            if (modified) {
              localStorage.setItem(storageKey, modified);
            }
          })
          .catch(error => console.log('Hot reload check failed:', error));
      }
      
      // Start checking for changes every second
      setInterval(checkForChanges, 1000);
      showNotification('ðŸ”¥ Hot reload active');
      console.log('âœ… Hot reload system enabled');
      
      // Manual reload shortcut
      document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'R') {
          e.preventDefault();
          showNotification('ðŸ”„ Manual reload triggered', '#dc3545');
          setTimeout(() => window.location.reload(), 300);
        }
      });
    </script>
    <!-- Hot reload indicator -->
    <div id="hot-reload-indicator" style="position: fixed; top: 10px; right: 10px; background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; z-index: 9999; display: none;">
      ðŸ”¥ Hot Reload Active
    </div>
    <script>
      // Show hot reload indicator
      document.addEventListener('DOMContentLoaded', () => {
        const indicator = document.getElementById('hot-reload-indicator');
        if (indicator) {
          indicator.style.display = 'block';
          setTimeout(() => {
            indicator.style.opacity = '0.7';
          }, 2000);
        }
      });
    </script>
  </body>
</html>
